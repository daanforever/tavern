- content_for :header do
  .row
    .col-md-9
      %h1
        Projects
        = link_to refresh_registries_path, remote: true, id: 'refresh', class: 'btn btn-default btn-rotate', title: 'Refresh' do
          %span.glyphicon.glyphicon-repeat
          = t('.scan')

%table.table
  %thead
    %tr
      %th.col-md-4
      %th.col-md-2 Releases
      %th.col-md-3 Environments
      %th.col-md-3 Components
  %tbody
    - @projects.includes(:releases, :environments, :components).each do |project|
      %tr
        %td
          %blockquote
            %p
              = link_to project.name, project
              %small= project.description


        %td
          - project.releases.each do |release|
            %p
              = link_to release.name, release_path(release)
              - if release.active?
                %span.glyphicon.glyphicon-ok.text-success

        %td
          - if project.environments.count == 0
            %p
              = link_to new_project_environment_path(project), class: 'btn btn-default btn-sm btn-rotate' do
                %span.glyphicon.glyphicon-plus
                = t('.new_environment')
          - project.environments.each do |environment|
            .row
              .col-md-7
                %p
                  = link_to environment.name, environment
              .col-md-5
                %span.badge.badge-success{title: 'running'}= environment.instances.running.count
                %span.badge{title: 'stopped'}= environment.instances.stopped.count


        %td
          - project.components.each do |component|
            .row
              .col-md-8
                %p
                  = link_to component.name, component_path(component)
              .col-md-4
                %span.badge.badge-success{title: 'running'}= component.instances.running.count
                %span.badge{title: 'stopped'}= component.instances.stopped.count
